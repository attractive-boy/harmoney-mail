<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JD Mall ç®¡ç†åå°</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f0f2f5;color:#333}
/* â”€â”€ Login â”€â”€ */
#login-page{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%)}
.login-box{background:#fff;border-radius:16px;padding:48px 40px;width:380px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.login-logo{text-align:center;margin-bottom:32px}
.login-logo h1{font-size:24px;color:#e23935;font-weight:700;letter-spacing:1px}
.login-logo p{color:#888;font-size:13px;margin-top:4px}
.form-group{margin-bottom:20px}
.form-group label{display:block;font-size:13px;color:#666;margin-bottom:6px;font-weight:500}
.form-group input{width:100%;padding:11px 14px;border:1.5px solid #e0e0e0;border-radius:8px;font-size:14px;transition:.2s;outline:none}
.form-group input:focus{border-color:#e23935;box-shadow:0 0 0 3px rgba(226,57,53,.1)}
.btn-login{width:100%;padding:12px;background:linear-gradient(135deg,#e23935,#c0392b);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:.2s}
.btn-login:hover{opacity:.9;transform:translateY(-1px)}
.login-error{color:#e23935;font-size:13px;text-align:center;margin-top:12px}
/* â”€â”€ Layout â”€â”€ */
#app{display:none;height:100vh;overflow:hidden}
.topbar{height:56px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;padding:0 24px;position:fixed;top:0;left:0;right:0;z-index:100;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.topbar-logo{font-size:18px;font-weight:700;color:#e23935;margin-right:32px}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:16px}
.topbar-right .user-tag{font-size:13px;color:#666}
.btn-logout{padding:6px 14px;background:#fff;border:1.5px solid #e23935;color:#e23935;border-radius:6px;font-size:13px;cursor:pointer;transition:.2s}
.btn-logout:hover{background:#e23935;color:#fff}
.sidebar{width:220px;background:#1a1a2e;position:fixed;top:56px;left:0;bottom:0;overflow-y:auto}
.nav-item{display:flex;align-items:center;gap:10px;padding:13px 20px;color:#aab4c8;font-size:14px;cursor:pointer;transition:.2s;border-left:3px solid transparent}
.nav-item:hover{background:rgba(255,255,255,.07);color:#fff}
.nav-item.active{background:rgba(226,57,53,.15);color:#e23935;border-left-color:#e23935}
.nav-item .icon{font-size:16px;width:20px;text-align:center}
.content{margin-left:220px;margin-top:56px;padding:24px;overflow-y:auto;height:calc(100vh - 56px)}
/* â”€â”€ Cards â”€â”€ */
.panel{display:none}.panel.active{display:block}
.page-title{font-size:20px;font-weight:700;margin-bottom:20px;color:#1a1a2e}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px}
.stat-card{background:#fff;border-radius:12px;padding:20px 24px;box-shadow:0 1px 4px rgba(0,0,0,.06);display:flex;align-items:center;gap:16px}
.stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px}
.stat-info .value{font-size:26px;font-weight:700;line-height:1}
.stat-info .label{font-size:12px;color:#999;margin-top:4px}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.chart-card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.chart-card h3{font-size:14px;font-weight:600;color:#666;margin-bottom:16px}
/* â”€â”€ Table â”€â”€ */
.card{background:#fff;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,.06);overflow:hidden}
.card-header{padding:16px 20px;border-bottom:1px solid #f0f0f0;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.card-header h2{font-size:15px;font-weight:600;flex:1}
.search-input{padding:7px 12px;border:1.5px solid #e0e0e0;border-radius:7px;font-size:13px;width:220px;outline:none;transition:.2s}
.search-input:focus{border-color:#e23935}
.filter-select{padding:7px 10px;border:1.5px solid #e0e0e0;border-radius:7px;font-size:13px;outline:none;cursor:pointer}
.btn{padding:8px 16px;border:none;border-radius:7px;font-size:13px;cursor:pointer;font-weight:500;transition:.2s}
.btn-primary{background:#e23935;color:#fff}.btn-primary:hover{background:#c0392b}
.btn-success{background:#27ae60;color:#fff}.btn-success:hover{background:#229954}
.btn-warning{background:#f39c12;color:#fff}.btn-warning:hover{background:#e67e22}
.btn-danger{background:#e74c3c;color:#fff}.btn-danger:hover{background:#c0392b}
.btn-sm{padding:5px 10px;font-size:12px}
table{width:100%;border-collapse:collapse}
th{background:#fafafa;padding:12px 16px;text-align:left;font-size:13px;font-weight:600;color:#666;border-bottom:1px solid #f0f0f0}
td{padding:12px 16px;font-size:13px;border-bottom:1px solid #f8f8f8;vertical-align:middle}
tr:hover td{background:#fafcff}
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600}
.badge-active{background:#e8f5e9;color:#27ae60}
.badge-inactive{background:#fff3e0;color:#f39c12}
.badge-disabled{background:#fce4e4;color:#e74c3c}
.action-btns{display:flex;gap:6px;flex-wrap:wrap}
.pagination{display:flex;align-items:center;justify-content:flex-end;gap:8px;padding:12px 20px;font-size:13px;color:#666}
.page-btn{padding:5px 10px;border:1.5px solid #e0e0e0;border-radius:6px;background:#fff;cursor:pointer;font-size:12px}
.page-btn:hover{border-color:#e23935;color:#e23935}
.page-btn:disabled{opacity:.4;cursor:not-allowed}
/* â”€â”€ Modal â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:#fff;border-radius:14px;width:560px;max-width:95vw;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.modal-header{padding:20px 24px;border-bottom:1px solid #f0f0f0;display:flex;align-items:center;justify-content:space-between}
.modal-header h3{font-size:16px;font-weight:600}
.modal-close{background:none;border:none;font-size:20px;cursor:pointer;color:#999;line-height:1}
.modal-close:hover{color:#333}
.modal-body{padding:24px}
.modal-footer{padding:16px 24px;border-top:1px solid #f0f0f0;display:flex;justify-content:flex-end;gap:10px}
.field-group{margin-bottom:16px}
.field-group label{display:block;font-size:13px;color:#555;margin-bottom:6px;font-weight:500}
.field-group input,.field-group select,.field-group textarea{width:100%;padding:9px 12px;border:1.5px solid #e0e0e0;border-radius:7px;font-size:13px;outline:none;transition:.2s;font-family:inherit}
.field-group input:focus,.field-group select:focus,.field-group textarea:focus{border-color:#e23935}
.field-group textarea{resize:vertical;min-height:80px}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.img-preview{width:80px;height:60px;object-fit:cover;border-radius:6px;border:1px solid #eee;margin-top:4px}
/* â”€â”€ Toast â”€â”€ */
.toast{position:fixed;bottom:24px;right:24px;background:#333;color:#fff;padding:12px 20px;border-radius:8px;font-size:13px;z-index:999;opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}
/* â”€â”€ Misc â”€â”€ */
.empty{text-align:center;padding:40px;color:#bbb;font-size:14px}
.loading-mask{background:#f8f8f8;text-align:center;padding:32px;color:#bbb;font-size:13px}
</style>
</head>
<body>

<!-- Login -->
<div id="login-page">
  <div class="login-box">
    <div class="login-logo">
      <h1>ğŸ›ï¸ JD Mall</h1>
      <p>ç®¡ç†å‘˜åå°ç³»ç»Ÿ</p>
    </div>
    <div class="form-group">
      <label>ç”¨æˆ·å</label>
      <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="admin">
    </div>
    <div class="form-group">
      <label>å¯†ç </label>
      <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " value="admin123">
    </div>
    <button class="btn-login" onclick="doLogin()">ç™» å½•</button>
    <p class="login-error" id="login-err"></p>
  </div>
</div>

<!-- App Shell -->
<div id="app">
  <div class="topbar">
    <span class="topbar-logo">ğŸ›ï¸ JD Mall Admin</span>
    <div class="topbar-right">
      <span class="user-tag">ğŸ‘¤ <span id="admin-name">admin</span></span>
      <button class="btn-logout" onclick="doLogout()">é€€å‡ºç™»å½•</button>
    </div>
  </div>

  <div class="sidebar">
    <div class="nav-item active" onclick="switchPanel('dashboard')"><span class="icon">ğŸ“Š</span>ä»ªè¡¨ç›˜</div>
    <div class="nav-item" onclick="switchPanel('users')"><span class="icon">ğŸ‘¥</span>ç”¨æˆ·ç®¡ç†</div>
    <div class="nav-item" onclick="switchPanel('goods')"><span class="icon">ğŸ“¦</span>å•†å“ç®¡ç†</div>
    <div class="nav-item" onclick="switchPanel('news')"><span class="icon">ğŸ“°</span>èµ„è®¯ç®¡ç†</div>
    <div class="nav-item" onclick="switchPanel('analytics')"><span class="icon">ğŸ“ˆ</span>é”€é‡åˆ†æ</div>
  </div>

  <div class="content">

    <!-- Dashboard -->
    <div class="panel active" id="panel-dashboard">
      <div class="page-title">ä»ªè¡¨ç›˜æ¦‚è§ˆ</div>
      <div class="stats-grid" id="stats-grid"></div>
      <div class="charts-row">
        <div class="chart-card"><h3>å„åˆ†ç±»é”€é‡</h3><canvas id="chart-cat" height="200"></canvas></div>
        <div class="chart-card"><h3>è®¢å•çŠ¶æ€åˆ†å¸ƒ</h3><canvas id="chart-order" height="200"></canvas></div>
      </div>
    </div>

    <!-- Users -->
    <div class="panel" id="panel-users">
      <div class="page-title">ç”¨æˆ·ç®¡ç†</div>
      <div class="card">
        <div class="card-header">
          <h2>ç”¨æˆ·åˆ—è¡¨</h2>
          <input type="text" class="search-input" id="user-kw" placeholder="æœç´¢é‚®ç®±/æ‰‹æœº/æ˜µç§°â€¦" onkeydown="if(event.key==='Enter')loadUsers()">
          <select class="filter-select" id="user-status" onchange="loadUsers()">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="ACTIVE">æ­£å¸¸</option>
            <option value="DISABLED">ç¦ç”¨</option>
          </select>
          <button class="btn btn-primary" onclick="loadUsers()">æœç´¢</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>é‚®ç®±</th><th>æ‰‹æœº</th><th>æ˜µç§°</th><th>ç§¯åˆ†</th><th>çŠ¶æ€</th><th>æ³¨å†Œæ—¶é—´</th><th>æ“ä½œ</th></tr></thead>
          <tbody id="user-tbody"></tbody>
        </table>
        <div class="pagination" id="user-page"></div>
      </div>
    </div>

    <!-- Goods -->
    <div class="panel" id="panel-goods">
      <div class="page-title">å•†å“ç®¡ç†</div>
      <div class="card">
        <div class="card-header">
          <h2>å•†å“åˆ—è¡¨</h2>
          <input type="text" class="search-input" id="goods-kw" placeholder="æœç´¢å•†å“å/åˆ†ç±»â€¦" onkeydown="if(event.key==='Enter')loadGoods()">
          <select class="filter-select" id="goods-status" onchange="loadGoods()">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="ACTIVE">å·²ä¸Šæ¶</option>
            <option value="INACTIVE">å·²ä¸‹æ¶</option>
          </select>
          <button class="btn btn-primary" onclick="loadGoods()">æœç´¢</button>
          <button class="btn btn-success" onclick="openGoodsModal()">+ æ–°å¢å•†å“</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>å›¾ç‰‡</th><th>å•†å“åç§°</th><th>åˆ†ç±»</th><th>ä»·æ ¼</th><th>é”€é‡</th><th>çŠ¶æ€</th><th>ä¸Šæ¶æ—¶é—´</th><th>æ“ä½œ</th></tr></thead>
          <tbody id="goods-tbody"></tbody>
        </table>
        <div class="pagination" id="goods-page"></div>
      </div>
    </div>

    <!-- News -->
    <div class="panel" id="panel-news">
      <div class="page-title">èµ„è®¯ç®¡ç†</div>
      <div class="card">
        <div class="card-header">
          <h2>èµ„è®¯åˆ—è¡¨</h2>
          <button class="btn btn-success" onclick="openNewsModal()">+ å‘å¸ƒèµ„è®¯</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>æ ‡é¢˜</th><th>åˆ†ç±»</th><th>æ¥æº</th><th>é˜…è¯»é‡</th><th>å‘å¸ƒæ—¥æœŸ</th><th>æ“ä½œ</th></tr></thead>
          <tbody id="news-tbody"></tbody>
        </table>
        <div class="pagination" id="news-page"></div>
      </div>
    </div>

    <!-- Analytics -->
    <div class="panel" id="panel-analytics">
      <div class="page-title">é”€é‡åˆ†æ</div>
      <div class="stats-grid" id="analytics-stats"></div>
      <div class="charts-row">
        <div class="chart-card" style="grid-column:span 2"><h3>å„åˆ†ç±»æ€»é”€é‡</h3><canvas id="chart-cat2" height="120"></canvas></div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /app -->

<!-- Goods Modal -->
<div class="modal-overlay" id="goods-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="goods-modal-title">æ–°å¢å•†å“</h3>
      <button class="modal-close" onclick="closeModal('goods-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="goods-id">
      <div class="field-row">
        <div class="field-group"><label>å•†å“åç§° *</label><input id="g-desc" placeholder="è¯·è¾“å…¥å•†å“åç§°"></div>
        <div class="field-group"><label>ä»·æ ¼ *</label><input id="g-price" placeholder="ä¾‹ï¼š299.00"></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>åˆ†ç±»ç¼–ç </label><input id="g-category" placeholder="ä¾‹ï¼šphone"></div>
        <div class="field-group"><label>åº—é“ºå</label><input id="g-store" placeholder="è¯·è¾“å…¥åº—é“ºå"></div>
      </div>
      <div class="field-group"><label>å•†å“å›¾ç‰‡URL</label><input id="g-img" placeholder="https://..." oninput="previewImg()"></div>
      <img id="g-img-preview" class="img-preview" style="display:none">
      <div class="field-row">
        <div class="field-group"><label>å‰¯æ ‡é¢˜1</label><input id="g-des1" placeholder=""></div>
        <div class="field-group"><label>å‰¯æ ‡é¢˜2</label><input id="g-des2" placeholder=""></div>
      </div>
      <div class="field-row">
        <div class="field-group">
          <label>çŠ¶æ€</label>
          <select id="g-status">
            <option value="ACTIVE">å·²ä¸Šæ¶</option>
            <option value="INACTIVE">ä¸‹æ¶</option>
          </select>
        </div>
        <div class="field-group">
          <label>æ¨èå•†å“</label>
          <select id="g-recommend">
            <option value="false">å¦</option>
            <option value="true">æ˜¯</option>
          </select>
        </div>
      </div>
      <div class="field-group"><label>æ ‡ç­¾ (tag)</label><input id="g-tag" placeholder="å…³é”®æ ‡ç­¾"></div>
    </div>
    <div class="modal-footer">
      <button class="btn" style="background:#f0f0f0" onclick="closeModal('goods-modal')">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="saveGoods()">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- News Modal -->
<div class="modal-overlay" id="news-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="news-modal-title">å‘å¸ƒèµ„è®¯</h3>
      <button class="modal-close" onclick="closeModal('news-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="news-id">
      <div class="field-group"><label>æ ‡é¢˜ *</label><input id="n-title" placeholder="è¯·è¾“å…¥èµ„è®¯æ ‡é¢˜"></div>
      <div class="field-row">
        <div class="field-group">
          <label>åˆ†ç±»</label>
          <select id="n-category">
            <option value="INDUSTRY">è¡Œä¸šåŠ¨æ€</option>
            <option value="TECH">æŠ€æœ¯è¶‹åŠ¿</option>
          </select>
        </div>
        <div class="field-group"><label>æ¥æº</label><input id="n-source" placeholder="ä¾‹ï¼šè¡Œä¸šè§‚å¯Ÿ"></div>
      </div>
      <div class="field-group"><label>å°é¢å›¾URL</label><input id="n-img" placeholder="https://..."></div>
      <div class="field-group"><label>æ‘˜è¦</label><textarea id="n-summary" rows="2" placeholder="ä¸€å¥è¯ç®€ä»‹â€¦"></textarea></div>
      <div class="field-group"><label>æ­£æ–‡å†…å®¹</label><textarea id="n-content" rows="8" placeholder="æ”¯æŒ â–Œ å¼€å¤´çš„æ®µè½æ ‡é¢˜ã€- å¼€å¤´çš„åˆ—è¡¨é¡¹â€¦"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn" style="background:#f0f0f0" onclick="closeModal('news-modal')">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="saveNews()">å‘å¸ƒ</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE = '';  // same origin
let TOKEN = '';
let catChart, orderChart, cat2Chart;

const ORDER_STATUS_LABEL = {
  PENDING_PAYMENT:'å¾…ä»˜æ¬¾', PENDING_SHIPMENT:'å¾…å‘è´§',
  PENDING_RECEIPT:'å¾…æ”¶è´§', COMPLETED:'å·²å®Œæˆ', CANCELLED:'å·²å–æ¶ˆ'
};

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const res = await api('/admin/login', { username, password });
  if (res.code === '0') {
    TOKEN = res.data.token;
    document.getElementById('admin-name').textContent = res.data.username;
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    loadDashboard();
  } else {
    document.getElementById('login-err').textContent = res.msg || 'ç™»å½•å¤±è´¥';
  }
}

function doLogout() {
  TOKEN = '';
  document.getElementById('login-page').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  event.currentTarget.classList.add('active');
  if (name === 'dashboard') loadDashboard();
  if (name === 'users') loadUsers();
  if (name === 'goods') loadGoods();
  if (name === 'news') loadNews();
  if (name === 'analytics') loadAnalytics();
}

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, body) {
  const payload = Object.assign({ token: TOKEN }, body);
  const r = await fetch(BASE + path, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  return r.json();
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, isErr) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.style.background = isErr ? '#e23935' : '#27ae60';
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2500);
}

// â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  const res = await api('/admin/dashboard', {});
  if (res.code !== '0') return;
  const d = res.data;
  const stats = [
    { label:'æ€»ç”¨æˆ·', value: d.totalUsers, icon:'ğŸ‘¥', bg:'#e3f2fd', c:'#1565c0' },
    { label:'æ­£å¸¸ç”¨æˆ·', value: d.activeUsers, icon:'âœ…', bg:'#e8f5e9', c:'#2e7d32' },
    { label:'æ€»å•†å“', value: d.totalGoods, icon:'ğŸ“¦', bg:'#fff3e0', c:'#e65100' },
    { label:'å·²ä¸Šæ¶', value: d.activeGoods, icon:'ğŸŸ¢', bg:'#f3e5f5', c:'#6a1b9a' },
    { label:'æ€»è®¢å•', value: d.totalOrders, icon:'ğŸ§¾', bg:'#fce4ec', c:'#880e4f' },
    { label:'æ€»èµ„è®¯', value: d.totalArticles, icon:'ğŸ“°', bg:'#e0f7fa', c:'#00695c' },
  ];
  document.getElementById('stats-grid').innerHTML = stats.map(s =>
    `<div class="stat-card">
       <div class="stat-icon" style="background:${s.bg};color:${s.c}">${s.icon}</div>
       <div class="stat-info"><div class="value" style="color:${s.c}">${s.value}</div><div class="label">${s.label}</div></div>
     </div>`
  ).join('');
  // category sales chart
  const cats = d.categorySales || [];
  if (catChart) catChart.destroy();
  catChart = new Chart(document.getElementById('chart-cat'), {
    type: 'bar',
    data: {
      labels: cats.map(c => c.category || 'æ— '),
      datasets: [{ label:'é”€é‡', data: cats.map(c => c.sales || 0),
        backgroundColor: '#e23935', borderRadius: 4 }]
    },
    options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });
  // order status pie
  const os = d.orderStats || {};
  if (orderChart) orderChart.destroy();
  orderChart = new Chart(document.getElementById('chart-order'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(os).map(k => ORDER_STATUS_LABEL[k] || k),
      datasets: [{ data: Object.values(os),
        backgroundColor: ['#ffc107','#2196f3','#9c27b0','#4caf50','#f44336'] }]
    },
    options: { plugins: { legend: { position: 'right' } }, cutout:'60%' }
  });
}

// â”€â”€ Users â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let userPage = 0;
async function loadUsers(pg) {
  if (pg !== undefined) userPage = pg;
  const res = await api('/admin/user/list', {
    keyword: document.getElementById('user-kw').value,
    status: document.getElementById('user-status').value,
    page: userPage, size: 15
  });
  if (res.code !== '0') { toast(res.msg || 'åŠ è½½å¤±è´¥', true); return; }
  const d = res.data;
  document.getElementById('user-tbody').innerHTML = (d.list || []).map(u =>
    `<tr>
      <td>${u.id}</td>
      <td>${u.email || '-'}</td>
      <td>${u.phone || '-'}</td>
      <td>${u.nickname || '-'}</td>
      <td>${u.points || 0}</td>
      <td><span class="badge ${u.status === 'ACTIVE' ? 'badge-active' : 'badge-disabled'}">${u.status === 'ACTIVE' ? 'æ­£å¸¸' : 'ç¦ç”¨'}</span></td>
      <td>${u.createdAt}</td>
      <td class="action-btns">
        <button class="btn btn-sm ${u.status === 'ACTIVE' ? 'btn-warning' : 'btn-success'}"
          onclick="toggleUser(${u.id})">${u.status === 'ACTIVE' ? 'ç¦ç”¨' : 'å¯ç”¨'}</button>
      </td>
    </tr>`
  ).join('') || '<tr><td colspan="8" class="empty">æš‚æ— æ•°æ®</td></tr>';
  renderPagination('user-page', userPage, d.totalPages, 'loadUsers');
}
async function toggleUser(id) {
  const res = await api('/admin/user/toggleStatus', { id });
  res.code === '0' ? (toast('çŠ¶æ€å·²æ›´æ–°'), loadUsers()) : toast(res.msg || 'æ“ä½œå¤±è´¥', true);
}

// â”€â”€ Goods â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let goodsPage = 0;
async function loadGoods(pg) {
  if (pg !== undefined) goodsPage = pg;
  const res = await api('/admin/goods/list', {
    keyword: document.getElementById('goods-kw').value,
    status: document.getElementById('goods-status').value,
    page: goodsPage, size: 15
  });
  if (res.code !== '0') { toast(res.msg || 'åŠ è½½å¤±è´¥', true); return; }
  const d = res.data;
  document.getElementById('goods-tbody').innerHTML = (d.list || []).map(g =>
    `<tr>
      <td>${g.id}</td>
      <td>${g.imgUrl ? `<img src="${g.imgUrl}" style="width:50px;height:40px;object-fit:cover;border-radius:4px;border:1px solid #eee" onerror="this.style.display='none'">` : '-'}</td>
      <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${g.description}">${g.description || '-'}</td>
      <td>${g.categoryCode || '-'}</td>
      <td>Â¥${g.price || 0}</td>
      <td>${g.salesCount || 0}</td>
      <td><span class="badge ${g.status === 'ACTIVE' ? 'badge-active' : 'badge-inactive'}">${g.status === 'ACTIVE' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}</span></td>
      <td>${g.createdAt}</td>
      <td class="action-btns">
        <button class="btn btn-sm btn-primary" onclick="editGoods(${g.id})">ç¼–è¾‘</button>
        <button class="btn btn-sm ${g.status === 'ACTIVE' ? 'btn-warning' : 'btn-success'}"
          onclick="toggleGoods(${g.id})">${g.status === 'ACTIVE' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}</button>
      </td>
    </tr>`
  ).join('') || '<tr><td colspan="9" class="empty">æš‚æ— æ•°æ®</td></tr>';
  renderPagination('goods-page', goodsPage, d.totalPages, 'loadGoods');
}
let editingGoods = null;
function openGoodsModal(g) {
  editingGoods = g || null;
  document.getElementById('goods-modal-title').textContent = g ? 'ç¼–è¾‘å•†å“' : 'æ–°å¢å•†å“';
  document.getElementById('goods-id').value = g ? g.id : '';
  document.getElementById('g-desc').value = g ? (g.description || '') : '';
  document.getElementById('g-price').value = g ? (g.price || '') : '';
  document.getElementById('g-category').value = g ? (g.categoryCode || '') : '';
  document.getElementById('g-store').value = g ? (g.storeName || '') : '';
  document.getElementById('g-img').value = g ? (g.imgUrl || '') : '';
  document.getElementById('g-des1').value = g ? (g.des1 || '') : '';
  document.getElementById('g-des2').value = g ? (g.des2 || '') : '';
  document.getElementById('g-tag').value = g ? (g.tag || '') : '';
  document.getElementById('g-status').value = g ? (g.status || 'ACTIVE') : 'ACTIVE';
  document.getElementById('g-recommend').value = g ? String(g.recommend) : 'false';
  previewImg();
  document.getElementById('goods-modal').classList.add('open');
}
async function editGoods(id) {
  const res = await api('/admin/goods/list', { keyword: String(id), page: 0, size: 1 });
  // fallback: open with id only
  const g = res.data?.list?.[0];
  openGoodsModal(g || { id });
}
function previewImg() {
  const v = document.getElementById('g-img').value;
  const img = document.getElementById('g-img-preview');
  if (v) { img.src = v; img.style.display = 'block'; } else { img.style.display = 'none'; }
}
async function saveGoods() {
  const id = document.getElementById('goods-id').value;
  const body = {
    description: document.getElementById('g-desc').value,
    price: document.getElementById('g-price').value,
    categoryCode: document.getElementById('g-category').value,
    storeName: document.getElementById('g-store').value,
    imgUrl: document.getElementById('g-img').value,
    des1: document.getElementById('g-des1').value,
    des2: document.getElementById('g-des2').value,
    tag: document.getElementById('g-tag').value,
    status: document.getElementById('g-status').value,
    recommend: document.getElementById('g-recommend').value,
  };
  if (id) body.id = id;
  const res = await api(id ? '/admin/goods/update' : '/admin/goods/create', body);
  if (res.code === '0') { toast('ä¿å­˜æˆåŠŸ'); closeModal('goods-modal'); loadGoods(); }
  else toast(res.msg || 'ä¿å­˜å¤±è´¥', true);
}
async function toggleGoods(id) {
  const res = await api('/admin/goods/toggleStatus', { id });
  res.code === '0' ? (toast('çŠ¶æ€å·²æ›´æ–°'), loadGoods()) : toast(res.msg || 'æ“ä½œå¤±è´¥', true);
}

// â”€â”€ News â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let newsPage = 0;
async function loadNews(pg) {
  if (pg !== undefined) newsPage = pg;
  const res = await api('/admin/news/list', { page: newsPage, size: 15 });
  if (res.code !== '0') { toast(res.msg || 'åŠ è½½å¤±è´¥', true); return; }
  const d = res.data;
  document.getElementById('news-tbody').innerHTML = (d.list || []).map(a =>
    `<tr>
      <td>${a.id}</td>
      <td style="max-width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${a.title}">${a.title}</td>
      <td><span class="badge ${a.category === 'TECH' ? 'badge-active' : 'badge-inactive'}">${a.category === 'TECH' ? 'æŠ€æœ¯è¶‹åŠ¿' : 'è¡Œä¸šåŠ¨æ€'}</span></td>
      <td>${a.source || '-'}</td>
      <td>${a.viewCount || 0}</td>
      <td>${a.publishedAt}</td>
      <td class="action-btns">
        <button class="btn btn-sm btn-primary" onclick="editNews(${JSON.stringify(a).split('"').join('&quot;')})">ç¼–è¾‘</button>
        <button class="btn btn-sm btn-danger" onclick="deleteNews(${a.id})">åˆ é™¤</button>
      </td>
    </tr>`
  ).join('') || '<tr><td colspan="7" class="empty">æš‚æ— æ•°æ®</td></tr>';
  renderPagination('news-page', newsPage, d.totalPages, 'loadNews');
}
function openNewsModal() {
  document.getElementById('news-modal-title').textContent = 'å‘å¸ƒèµ„è®¯';
  document.getElementById('news-id').value = '';
  ['n-title','n-source','n-img','n-summary','n-content'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('n-category').value = 'INDUSTRY';
  document.getElementById('news-modal').classList.add('open');
}
function editNews(a) {
  if (typeof a === 'string') a = JSON.parse(a);
  document.getElementById('news-modal-title').textContent = 'ç¼–è¾‘èµ„è®¯';
  document.getElementById('news-id').value = a.id;
  document.getElementById('n-title').value = a.title || '';
  document.getElementById('n-category').value = a.category || 'INDUSTRY';
  document.getElementById('n-source').value = a.source || '';
  document.getElementById('n-img').value = a.imageUrl || '';
  document.getElementById('n-summary').value = a.summary || '';
  document.getElementById('n-content').value = a.content || '';
  document.getElementById('news-modal').classList.add('open');
}
async function saveNews() {
  const id = document.getElementById('news-id').value;
  const body = {
    title: document.getElementById('n-title').value,
    category: document.getElementById('n-category').value,
    source: document.getElementById('n-source').value,
    imageUrl: document.getElementById('n-img').value,
    summary: document.getElementById('n-summary').value,
    content: document.getElementById('n-content').value,
  };
  if (id) body.id = id;
  const res = await api(id ? '/admin/news/update' : '/admin/news/create', body);
  if (res.code === '0') { toast('å‘å¸ƒæˆåŠŸ'); closeModal('news-modal'); loadNews(); }
  else toast(res.msg || 'å‘å¸ƒå¤±è´¥', true);
}
async function deleteNews(id) {
  if (!confirm('ç¡®è®¤åˆ é™¤è¯¥èµ„è®¯ï¼Ÿ')) return;
  const res = await api('/admin/news/delete', { id });
  res.code === '0' ? (toast('å·²åˆ é™¤'), loadNews()) : toast(res.msg || 'åˆ é™¤å¤±è´¥', true);
}

// â”€â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAnalytics() {
  const res = await api('/admin/analytics/sales', {});
  if (res.code !== '0') return;
  const d = res.data;
  document.getElementById('analytics-stats').innerHTML = `
    <div class="stat-card">
      <div class="stat-icon" style="background:#fce4ec;color:#c62828">ğŸ’°</div>
      <div class="stat-info"><div class="value" style="color:#c62828">Â¥${d.totalRevenue || 0}</div><div class="label">ç´¯è®¡è®¢å•é‡‘é¢</div></div>
    </div>
    ${Object.entries(d.orderStatusCount || {}).map(([k,v]) =>
      `<div class="stat-card">
        <div class="stat-info"><div class="value">${v}</div><div class="label">${ORDER_STATUS_LABEL[k] || k}</div></div>
       </div>`
    ).join('')}
  `;
  const cats = d.categorySales || [];
  if (cat2Chart) cat2Chart.destroy();
  cat2Chart = new Chart(document.getElementById('chart-cat2'), {
    type: 'bar',
    data: {
      labels: cats.map(c => c.category || 'æ— '),
      datasets: [{ label:'æ€»é”€é‡', data: cats.map(c => c.sales || 0),
        backgroundColor: cats.map((_,i) => `hsl(${i*40},70%,55%)`), borderRadius: 6 }]
    },
    options: { plugins: { legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
  });
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPagination(elId, page, totalPages, fn) {
  document.getElementById(elId).innerHTML =
    `<button class="page-btn" ${page===0?'disabled':''} onclick="${fn}(${page-1})">â€¹ ä¸Šä¸€é¡µ</button>
     <span>ç¬¬ ${page+1} / ${totalPages||1} é¡µ</span>
     <button class="page-btn" ${page+1>=totalPages?'disabled':''} onclick="${fn}(${page+1})">ä¸‹ä¸€é¡µ â€º</button>`;
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if(e.target===m) m.classList.remove('open'); }));
document.addEventListener('keydown', e => { if(e.key==='Enter' && document.getElementById('login-page').style.display!=='none') doLogin(); });
</script>
</body>
</html>
